---
import dayjs from "dayjs"
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

export async function getStaticPaths() {
  const guides = await getCollection("guides");

  return guides.map((guide) => ({
    params: { slug: guide.slug },
    props: { guide },
  }));
}

const { guide } = Astro.props;
const { Content, remarkPluginFrontmatter } = await guide.render();
const parsedDate = remarkPluginFrontmatter.lastModified ? dayjs(remarkPluginFrontmatter.lastModified) : null;
const formattedDate = parsedDate?.isValid() 
  ? parsedDate.tz("America/Chicago").format("MMMM DD, YYYY") 
  : "Unknown"; 
---

<BaseLayout title={guide.data.title}>
  <nav class="mb-6 flex items-center gap-2 text-sm text-wiki-muted [&_a]:no-underline">
    <a href="/" class="hover:text-wiki-link">Home</a>
    <span>/</span>
    <a href="/guides" class="hover:text-wiki-link">Guides</a>
    <span>/</span>
    <span class="text-wiki-text">{guide.data.title}</span>
  </nav>

  <div class="mb-8">
    <h1 class="mb-2">{guide.data.title}</h1>
    {guide.data.description && (
      <p class="text-wiki-muted text-lg mb-0">{guide.data.description}</p>
    )}
  </div>

  <div class="prose max-w-none">
    <Content />
  </div>
  {formattedDate && (
    <p class="mt-12 pt-4 border-t border-wiki-border text-sm text-wiki-muted">
        Last updated: {formattedDate}
    </p>
  )}
</BaseLayout>
